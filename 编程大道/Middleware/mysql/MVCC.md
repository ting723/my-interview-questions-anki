# MYSQL

## MVCC

<!-- notecardId: 1735053435809 -->

### MVCC 实现机制

MVCC（Multi-Version Concurrency Control，多版本并发控制）是 InnoDB 存储引擎用来实现事务隔离级别的一种技术。它通过保存数据的多个版本来实现读写操作的并发控制。InnoDB 的 MVCC 主要依赖于以下几个方面：

1. **隐藏列**：每行记录有两个隐藏列，用于存储行的创建时间和删除时间（实际上是事务 ID）。
2. **Undo Log**：当事务对数据进行修改时，会生成一条 Undo Log 记录，用于保存数据修改前的版本。
3. **Read View**：事务在读取数据时，会生成一个 Read View，用于确定当前事务可以看到的数据版本。

### MVCC 的工作原理

1. **插入操作**：插入新记录时，记录的创建时间设置为当前事务 ID，删除时间为空。
2. **删除操作**：删除记录时，记录的删除时间设置为当前事务 ID。
3. **更新操作**：更新记录时，生成一条新的记录，新的记录创建时间为当前事务 ID，旧记录的删除时间设置为当前事务 ID。
4. **读取操作**：读取记录时，通过 Read View 判断记录的创建时间和删除时间，决定是否可见。

### 使用场景

MVCC 主要用于以下场景：

1. **高并发读写场景**：在高并发读写场景下，MVCC 可以减少锁的争用，提高系统的并发性能。
2. **事务隔离级别**：MVCC 支持实现不同的事务隔离级别，如读已提交（Read Committed）和可重复读（Repeatable Read）。
3. **历史数据查询**：通过 Undo Log，可以实现历史数据的查询，方便数据恢复和审计。

MVCC 是 InnoDB 存储引擎实现高性能事务处理的重要机制之一，通过多版本并发控制，可以有效提高数据库的并发性能和数据一致性。
