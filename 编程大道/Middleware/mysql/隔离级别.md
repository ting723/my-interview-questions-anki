# 编程大道::Middleware::mysql

## 隔离级别

<!-- notecardId: 1735046875271 -->

### 在 MySQL 中，事务的隔离级别决定一个事务在多大程度上受到其他事务的影响。MySQL 支持以下四种隔离级别

1. **读未提交（Read Uncommitted）**
   - 事务可以读取其他事务未提交的数据，可能会导致脏读（Dirty Read）。
   - 没有采取任何特殊机制来避免脏读、不可重复读和幻读。
2. **读已提交（Read Committed）**
   - 事务只能读取其他事务已提交的数据，避免了脏读，但可能会导致不可重复读（Non-repeatable Read）。
   - 但对于不可重复读和幻读，它没有额外的机制去完全避免。
3. **可重复读（Repeatable Read）**
   - 通过在事务开始时创建一致性视图，并在事务期间使用这个视图来读取数据，从而避免了不可重复读。
   - 对于幻读，MySQL 的 InnoDB 存储引擎通过**多版本并发控制（MVCC）**和**间隙锁**机制来尽量减少幻读的影响，但不能完全杜绝。
   - 事务在开始时看到的数据一致，避免了脏读和不可重复读，但可能会导致幻读（Phantom Read）。MySQL 的默认隔离级别。
4. **可串行化（Serializable）**
   - 最高的隔离级别，通过强制事务顺序执行，完全避免脏读、不可重复读和幻读，但并发性能较低。

### 其他

> - 脏读指的是一个事务读取了另一个事务未提交的数据，然后这个事务回滚，导致数据不一致。脏读是最不安全的隔离级别，因为它可能导致数据不一致。
> - 不可重复读：是指在一个事务内，多次读取同一数据集合，但是在这个过程中，另一个事务对该数据集合进行了修改并提交，导致事务内前后读取的数据不一致。例如，事务 A 第一次读取某行数据，然后事务 B 修改了这行数据并提交，接着事务 A 再次读取这行数据时，得到的结果与第一次不同。
> - 幻读：幻读侧重于操作的影响范围。在一个事务中，按照某个条件进行查询，然后另一个事务插入了符合该条件的新数据并提交。当第一个事务再次按照相同条件查询时，会发现多了一些之前没有的数据，就好像出现了 “幻觉” 一样

可以使用以下命令查看和设置 MySQL 的隔离级别：

```sql
-- 查看当前隔离级别
SELECT @@transaction_isolation;

-- 设置隔离级别
SET GLOBAL transaction_isolation = 'REPEATABLE-READ';
```
