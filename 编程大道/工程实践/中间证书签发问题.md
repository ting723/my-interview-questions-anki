# PKI

## JIDU CA 证书签发问题

<!-- notecardId: 1735487191436 -->

### 工作中遇到的难题

> 问题一： 在二级证书签名时，必须设置 **_基本约束 ( 2.5.29.19 )_ 为 True，**否则签发的三级证书也无法构成完整的信任链接

- 解决过程：

  - 二级证书签发三级证书时，无法在 TLS 通信中使用
  - 当时，并没有 AI 搜索，对证书签发等新领域不是很熟悉，只能不停的搜索，最终在 stackoverflow 上找到相关答案

- 原因：

  - **信任链断裂问题**
  - > **基本概念** ：basicConstraints 是 X.509 证书中的一个重要扩展项，用于标识证书主体是否可以作为证书颁发机构（CA）来颁发其他证书，以及限制证书链的长度等。当 basicConstraints 设置为 true 时，表示该证书可以作为 CA 颁发下级证书；而设置为 false 时，则表示该证书是一个最终实体证书，不能再颁发下级证书。
  - > **信任链断裂问题** ：在一个正常的证书信任链中，根证书的 basicConstraints 通常为 true，它可以签发二级证书，二级证书如果 basicConstraints 也为 true，则可以继续签发三级证书等以此类推，形成一个完整的信任链。然而，当二级证书的 basicConstraints 被设置为 false 时，它就失去了作为 CA 签发有效三级证书的能力。从信任关系的角度来看，客户端在验证三级证书时，会沿着证书链向上追溯，发现二级证书不具备签发下级证书的权限，从而导致信任链断裂，认为三级证书是无效的，进而无法正常使用该三级证书 。
    > **应用场景限制** ：某些应用或系统在进行证书验证时，会严格检查证书链中每个证书的 basicConstraints 属性。如果二级证书的 basicConstraints 设置不符合预期，即使三级证书本身的其他信息都是正确的，也会被拒绝接受。比如在一些安全要求较高的网络环境中，服务器配置了严格的证书验证策略，要求所有的证书都必须符合标准的信任链结构，此时若二级证书的 basicConstraints 设置错误，其签发的三级证书就无法通过验证，相关的服务或操作也就无法正常进行，如安全的网站访问、加密通信等场景。

- 经验总结：

  - 在陌生领域，需要对相关的标准协议，要有快速了解一些
  - 使用 英文搜索等
  - 借助 AI 等工具实现快速搜索
  - 针对一些协议类的问题，借助 Wireshark 等抓包工具，采集到其错误码，能更快速定位相关问题
