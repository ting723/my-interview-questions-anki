# 事务

## 分布式事务

<!-- notecardId: 1735054279852 -->

分布式事务是指在分布式系统中，涉及多个独立的事务资源（如数据库、消息队列等）的事务操作。分布式事务确保这些操作要么全部成功，要么全部失败，从而保证数据的一致性和完整性。

### 相关协议

1. **两阶段提交协议（2PC）**

   - **准备阶段**：协调者向所有参与者发送准备请求，参与者执行事务并记录日志，但不提交。
   - **提交阶段**：如果所有参与者都准备成功，协调者发送提交请求，参与者提交事务；否则，协调者发送回滚请求，参与者回滚事务。

2. **三阶段提交协议（3PC）**

   - **准备阶段**：与 2PC 相同。
   - **预提交阶段**：协调者发送预提交请求，参与者确认可以提交。
   - **提交阶段**：如果所有参与者都预提交成功，协调者发送提交请求，参与者提交事务；否则，协调者发送回滚请求，参与者回滚事务。

3. **补偿事务（TCC）**
   - **Try**：尝试执行事务。
   - **Confirm**：确认提交事务。
   - **Cancel**：取消事务，进行补偿操作。

### 具体案例

1. **银行转账**

   - 在分布式系统中，涉及多个银行账户的转账操作需要保证一致性，可以使用 2PC 或 TCC 协议。

2. **电商订单处理**

   - 订单创建、库存扣减、支付处理等操作分布在不同的服务中，需要使用分布式事务来保证数据一致性。

3. **微服务架构**
   - 在微服务架构中，不同服务之间的调用需要保证事务一致性，可以使用 Saga 模式或 TCC 协议。
