# 分布式

## 分布式一致性

<!-- notecardId: 1735054231468 -->

分布式一致性是指在分布式系统中，多个节点在数据存储和处理上保持一致的能力。由于分布式系统中各个节点可能会出现网络延迟、节点故障等问题，保证数据的一致性是一个重要且复杂的课题。

### CAP 定理

CAP 定理指出，在一个分布式系统中，不可能同时满足以下三个特性：

- **一致性 (Consistency)**：所有节点在同一时间具有相同的数据。
- **可用性 (Availability)**：每个请求都能收到一个（成功或失败）响应。
- **分区容忍性 (Partition Tolerance)**：系统能够继续运行，即使网络分区将一些节点隔离开。

根据 CAP 定理，分布式系统只能在一致性、可用性和分区容忍性之间做出权衡。

### BASE 理论

BASE 理论是对 CAP 定理的进一步扩展，适用于大规模分布式系统。BASE 代表：

- **基本可用 (Basically Available)**：系统在出现故障时，允许部分可用性下降。
- **软状态 (Soft State)**：系统状态可以有一段时间的不一致。
- **最终一致性 (Eventual Consistency)**：系统最终会达到一致状态。

### 两阶段提交协议 (2PC)

两阶段提交协议是一种保证分布式事务一致性的协议，分为两个阶段：

1. **准备阶段**：协调者向所有参与者发送准备请求，参与者执行事务并将结果告知协调者。
2. **提交阶段**：如果所有参与者都准备成功，协调者发送提交请求；否则，发送回滚请求。

### 三阶段提交协议 (3PC)

三阶段提交协议是对两阶段提交协议的改进，增加了一个预备提交阶段，以减少协调者单点故障的影响：

1. **准备阶段**：协调者向所有参与者发送准备请求。
2. **预备提交阶段**：如果所有参与者都准备成功，协调者发送预备提交请求。
3. **提交阶段**：如果所有参与者都预备提交成功，协调者发送提交请求；否则，发送回滚请求。

### Paxos 协议

Paxos 协议是一种分布式一致性算法，主要用于解决分布式系统中的一致性问题。Paxos 协议通过提议者、接受者和学习者三个角色来达成一致。

### Raft 协议

Raft 协议是另一种分布式一致性算法，设计上更易于理解和实现。Raft 协议通过选举领导者来管理日志复制，从而保证一致性。

### 应用场景

分布式一致性在以下场景中尤为重要：

- **分布式数据库**：如 Google Spanner、Amazon DynamoDB 等。
- **分布式文件系统**：如 HDFS、Ceph 等。
- **分布式缓存**：如 Redis 集群、Memcached 等。
- **微服务架构**：保证不同服务之间的数据一致性。

分布式一致性是分布式系统中的核心问题之一，理解和应用相关理论和协议对于构建可靠的分布式系统至关重要。
