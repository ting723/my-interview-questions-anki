# Go

## Go 协程

<!-- notecardId: 1735051655559 -->

Go 协程（Goroutine）是 Go 语言中的一种轻量级线程实现，用于并发编程。它们由 Go 运行时管理，而不是操作系统。Go 协程的启动和切换开销非常小，可以在同一进程中同时运行数以万计的协程。

### 特点

- **轻量级**：Go 协程的内存占用非常小，初始栈大小只有几 KB，并且可以根据需要动态增长。
- **高效**：Go 协程的创建和销毁开销很低，切换速度快。
- **简单易用**：使用`go`关键字即可启动一个新的协程。

### 示例

```go
package main

import (
    "fmt"
    "time"
)

func say(s string) {
    for i := 0; i < 5; i++ {
        time.Sleep(100 * time.Millisecond)
        fmt.Println(s)
    }
}

func main() {
    go say("world")
    say("hello")
}
```

### Go 协程与线程的对比

| 特性     | Go 协程               | 线程                         |
| -------- | --------------------- | ---------------------------- |
| 管理方式 | 由 Go 运行时管理      | 由操作系统管理               |
| 创建开销 | 低                    | 高                           |
| 切换开销 | 低                    | 高                           |
| 内存占用 | 小（初始栈几 KB）     | 大（初始栈几 MB）            |
| 数量限制 | 可以创建大量协程      | 受限于操作系统资源           |
| 通信方式 | 通过 channel 进行通信 | 通过共享内存和锁机制进行通信 |

### Go 协程与线程的区别是什么？

- 内存消耗：
  - 线程通常需要较大的内存来维护其执行上下文，包括栈空间等。
  - 协程的内存消耗相对较小，因为其栈空间可以动态扩展，初始时占用的内存很少。
- 切换开销：
  - 线程切换涉及到操作系统内核态的切换，开销较大。
  - 协程切换发生在用户态，由 Go 运行时管理，切换开销很小。
- 创建和销毁成本：
  - 创建和销毁线程的成本较高，涉及系统资源的分配和释放。
  - 协程的创建和销毁非常轻量级，成本低。
- 并发性：
  - 线程是操作系统级别的并发机制。
  - 协程是在语言层面实现的更轻量级的并发，可以在单个线程上创建大量的协程，实现高效的并发编程。
- 调度方式：
  - 线程的调度由操作系统控制。
  - 协程的调度由 Go 运行时根据其算法进行调度。
- 通信方式：
  - 线程间通信通常需要使用同步原语，如锁、条件变量等，相对复杂。
  - 协程间可以通过通道（Channel）进行通信，方式更简洁直观。

Go 协程通过 channel 进行通信，避免了传统线程编程中的锁机制，从而减少了并发编程中的复杂性和错误。
